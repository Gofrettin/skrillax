use skrillax_packet::Packet;
use skrillax_protocol::define_protocol;
use skrillax_serde::*;

#[derive(Clone, Eq, PartialEq, PartialOrd, Copy, Serialize, ByteSize, Deserialize, Debug)]
pub enum LogoutMode {
    #[silkroad(value = 1)]
    Logout,
    #[silkroad(value = 2)]
    Restart,
}

#[derive(Clone, Serialize, ByteSize, Deserialize, Debug)]
pub enum LogoutResult {
    #[silkroad(value = 1)]
    Success { seconds_to_logout: u32, mode: LogoutMode },
    #[silkroad(value = 2)]
    Failure { error: u16 },
}

impl LogoutResult {
    pub fn success(seconds_to_logout: u32, mode: LogoutMode) -> Self {
        LogoutResult::Success {
            seconds_to_logout,
            mode,
        }
    }

    pub fn error(error: u16) -> Self {
        LogoutResult::Failure { error }
    }

    pub fn wait_30_seconds() -> Self {
        LogoutResult::Failure { error: 0x0804 }
    }
}

#[derive(Clone, Eq, PartialEq, PartialOrd, Copy, Serialize, Deserialize, ByteSize, Debug)]
pub enum AuthResultError {
    #[silkroad(value = 2)]
    InvalidData,
    #[silkroad(value = 3)]
    NotInService,
    #[silkroad(value = 4)]
    ServerFull,
    #[silkroad(value = 5)]
    IpLimit,
}

#[derive(Clone, Serialize, ByteSize, Deserialize, Debug)]
pub enum AuthResult {
    #[silkroad(value = 1)]
    Success { unknown_1: u8, unknown_2: u8 },
    #[silkroad(value = 2)]
    Failure { code: AuthResultError },
}

impl AuthResult {
    pub fn success() -> Self {
        AuthResult::Success {
            unknown_1: 3,
            unknown_2: 0,
        }
    }

    pub fn error(code: AuthResultError) -> Self {
        AuthResult::Failure { code }
    }
}

#[derive(Clone, ByteSize, Deserialize, Serialize, Packet, Debug)]
#[packet(opcode = 0x6103)]
pub struct AuthRequest {
    pub token: u32,
    pub username: String,
    pub password: String,
    pub unknown: u8,
    pub mac_bytes: [u8; 6],
}

#[derive(Clone, Serialize, ByteSize, Deserialize, Packet, Debug)]
#[packet(opcode = 0xA103)]
pub struct AuthResponse {
    pub result: AuthResult,
}

impl AuthResponse {
    pub fn new(result: AuthResult) -> Self {
        AuthResponse { result }
    }
}

#[derive(Clone, Deserialize, ByteSize, Serialize, Packet, Debug)]
#[packet(opcode = 0x7005)]
pub struct LogoutRequest {
    pub mode: LogoutMode,
}

#[derive(Clone, Serialize, ByteSize, Deserialize, Packet, Debug)]
#[packet(opcode = 0xB005)]
pub struct LogoutResponse {
    pub result: LogoutResult,
}

impl LogoutResponse {
    pub fn new(result: LogoutResult) -> Self {
        LogoutResponse { result }
    }
}

#[derive(Clone, Serialize, ByteSize, Deserialize, Packet, Debug)]
#[packet(opcode = 0x300A)]
pub struct LogoutFinished;

#[derive(Clone, Serialize, ByteSize, Deserialize, Packet, Debug)]
#[packet(opcode = 0x2212)]
pub struct Disconnect {
    pub unknown: u8,
}

impl Disconnect {
    pub fn new() -> Self {
        Disconnect { unknown: 0xFF }
    }
}

#[derive(Packet, Serialize, Deserialize, ByteSize, Clone, Debug, Copy)]
#[packet(opcode = 0x3612)]
pub struct UnknownLargePacket {
    data: [u8; 494],
}

impl UnknownLargePacket {
    pub fn new() -> Self {
        UnknownLargePacket {
            data: [
                0x00, 0x16, 0x01, 0x00, 0x00, 0x00, 0x01, 0x01, 0x12, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x01, 0x01, 0x13, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                0x00, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00, 0x01, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                0x00, 0x00, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x01, 0x01, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00,
                0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x05, 0x00, 0x00, 0x00, 0x01, 0x01, 0x0c, 0x00, 0x00, 0x00, 0x00,
                0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x06, 0x00, 0x00, 0x00, 0x01, 0x01, 0x0d, 0x00, 0x00, 0x00,
                0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0x00, 0x00, 0x00, 0x01, 0x01, 0x0e, 0x00, 0x00,
                0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x00, 0x00, 0x00, 0x01, 0x01, 0x0f, 0x00,
                0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x09, 0x00, 0x00, 0x00, 0x01, 0x01, 0x10,
                0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0a, 0x00, 0x00, 0x00, 0x01, 0x01,
                0x11, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0b, 0x00, 0x00, 0x00, 0x01,
                0x01, 0x18, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x17, 0x00, 0x00, 0x00,
                0x01, 0x01, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x00, 0x00,
                0x00, 0x01, 0x01, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x19, 0x00,
                0x00, 0x00, 0x01, 0x01, 0x05, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1a,
                0x00, 0x00, 0x00, 0x01, 0x01, 0x06, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                0x1b, 0x00, 0x00, 0x00, 0x01, 0x01, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                0x00, 0x1c, 0x00, 0x00, 0x00, 0x01, 0x01, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                0x00, 0x00, 0x1d, 0x00, 0x00, 0x00, 0x01, 0x01, 0x09, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                0x00, 0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x01, 0x01, 0x0a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                0x00, 0x00, 0x00, 0x00, 0x1f, 0x00, 0x00, 0x00, 0x01, 0x01, 0x0b, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                0x00, 0x00, 0x00, 0x00, 0x00, 0x5b, 0x00, 0x00, 0x00, 0x01, 0x05, 0x77, 0x00, 0x00, 0x00, 0x00, 0x00,
                0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                0x00, 0x79, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7a, 0x00, 0x00, 0x00,
                0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7b, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                0x00, 0x00, 0x00, 0x5c, 0x00, 0x00, 0x00, 0x01, 0x05, 0x7c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                0x00, 0x00, 0x00, 0x00, 0x7d, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7e,
                0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7f, 0x00, 0x00, 0x00, 0x00, 0x00,
                0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                0x00,
            ],
        }
    }
}

define_protocol! { AuthProtocol =>
    LogoutRequest,
    LogoutResponse,
    LogoutFinished,
    AuthRequest,
    AuthResponse,
    Disconnect
}
